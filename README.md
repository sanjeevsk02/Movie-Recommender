\# Movie Recommender System (Probabilistic Matrix Factorization)



This project implements a movie recommender system that predicts how a user will rate a movie using \*\*Probabilistic Matrix Factorization (PMF)\*\* and movie metadata from \*\*TMDB\*\*. The model is trained on the \*\*MovieLens 20M\*\* dataset.



The repository contains:



\- The full training pipeline

\- A prediction script

\- A Streamlit web demo

\- A demo notebook for quick inspection of the model



Raw datasets (MovieLens 20M and TMDB) are \*\*not included\*\* for size and licensing reasons. Instructions for placing them in the correct folders are provided below.



---



\## 1. Folder Structure



Assuming the project root is called `movie-recommender/`, the expected structure is:



```text

movie-recommender/

│

├── app.py                  # Streamlit web application

├── train.py                # Training script for the PMF model

├── predict.py              # Utility to predict rating for a user–movie pair

├── model.py                # PMF model definition (PyTorch)

├── data\_loader.py          # Data loading and preprocessing utilities

├── tmdb\_preprocess.py      # Script to preprocess TMDB metadata

├── demo.ipynb              # Jupyter notebook demo (optional inspection)

│

├── pmf\_model.pth           # Trained model weights (created by train.py)

│

├── requirements.txt        # Python dependencies

├── README.md               # This file

│

└── data/

&nbsp;   ├── ml-20m/             # MovieLens 20M dataset (must be downloaded separately)

&nbsp;   │   ├── ratings.csv

&nbsp;   │   ├── movies.csv

&nbsp;   │   ├── tags.csv

&nbsp;   │   ├── links.csv

&nbsp;   │   ├── genome-scores.csv

&nbsp;   │   └── genome-tags.csv

&nbsp;   │

&nbsp;   └── tmdb/               # TMDB metadata (must be downloaded separately)

&nbsp;       ├── tmdb\_5000\_movies.csv

&nbsp;       ├── tmdb\_5000\_credits.csv

&nbsp;       ├── tmdb\_features.npy          # generated by tmdb\_preprocess.py

&nbsp;       ├── tmdb\_index\_map.json        # generated by tmdb\_preprocess.py

&nbsp;       └── tmdb\_feature\_columns.json  # generated by tmdb\_preprocess.py

Notes:



The data/ml-20m/ and data/tmdb/ folders must be created manually and populated with the raw data files as described below.



tmdb\_features.npy, tmdb\_index\_map.json, and tmdb\_feature\_columns.json are generated from the raw TMDB CSV files by tmdb\_preprocess.py.



pmf\_model.pth is created by train.py after training, or can be provided in the repository using Git LFS.



2\. Dependencies

Install Python dependencies with:



bash

Copy code

pip install -r requirements.txt

The main libraries used are:



torch — PMF model and optimization



numpy, pandas — data handling



scikit-learn — train/test splitting and metrics



tqdm — progress bars



streamlit — web demo UI



3\. Datasets

3.1 MovieLens 20M

Download the MovieLens 20M dataset from:



https://grouplens.org/datasets/movielens/20m/



After downloading and extracting, place the files as:



text

Copy code

movie-recommender/

└── data/

&nbsp;   └── ml-20m/

&nbsp;       ├── ratings.csv

&nbsp;       ├── movies.csv

&nbsp;       ├── tags.csv

&nbsp;       ├── links.csv

&nbsp;       ├── genome-scores.csv

&nbsp;       └── genome-tags.csv

At minimum, ratings.csv and movies.csv are required by this project. The other files are part of the original dataset and can be present without modification.



3.2 TMDB Movie Metadata

Download the TMDB dataset from Kaggle:



https://www.kaggle.com/datasets/tmdb/tmdb-movie-metadata



From that download, place the following files into:



text

Copy code

movie-recommender/

└── data/

&nbsp;   └── tmdb/

&nbsp;       ├── tmdb\_5000\_movies.csv

&nbsp;       └── tmdb\_5000\_credits.csv

These two CSV files are used to construct the metadata features (genres, cast, etc.) for each movie.



4\. Preprocessing TMDB Metadata

Before training the model, TMDB metadata must be preprocessed into numerical features.



From the project root, run:



bash

Copy code

python tmdb\_preprocess.py

This script reads:



data/tmdb/tmdb\_5000\_movies.csv



data/tmdb/tmdb\_5000\_credits.csv



and produces:



data/tmdb/tmdb\_features.npy



data/tmdb/tmdb\_index\_map.json



data/tmdb/tmdb\_feature\_columns.json



These files are then used by data\_loader.py and train.py to incorporate metadata into the model.



5\. Training the Model

Once:



MovieLens 20M data is in data/ml-20m/



TMDB CSVs are in data/tmdb/



TMDB features have been preprocessed (tmdb\_preprocess.py has been run)



you can train the PMF model:



bash

Copy code

python train.py

What train.py does:



Loads ratings and movie information from data/ml-20m/ratings.csv and data/ml-20m/movies.csv



Loads the processed TMDB metadata from data/tmdb/tmdb\_features.npy



Builds user and movie embeddings with PMF



Trains for a fixed number of epochs (configurable inside train.py)



Evaluates on a held-out test split using RMSE (and optionally MAE)



Saves the trained weights to:



text

Copy code

pmf\_model.pth

If pmf\_model.pth already exists, it will be overwritten unless you change the path in train.py.



Training on CPU is possible but slow. A GPU (CUDA) is recommended.



6\. Predicting a Rating from Python

predict.py provides a simple function predict\_rating that uses the trained model to estimate a rating for a given user and movie title.



Example usage (from a Python shell or script):



python

Copy code

from predict import predict\_rating



user\_id = 1

movie\_title = "Toy Story (1995)"  # must match MovieLens title formatting



rating = predict\_rating(user\_id=user\_id, movie\_title=movie\_title, use\_metadata=True)

print(f"Predicted rating for {movie\_title} by user {user\_id}: {rating:.2f}")

This function:



Loads the MovieLens mappings (user and movie indices)



Loads the trained model from pmf\_model.pth



Looks up the movie by title



Runs a forward pass through the PMF model



Returns the predicted rating (typically in the 0.5–5.0 range)



7\. Running the Streamlit Web App

The Streamlit app provides an interactive interface to the recommender.



From the project root, run:



bash

Copy code

streamlit run app.py

The app will:



Load the trained model (pmf\_model.pth)



Load the MovieLens movie list



Let you select:



A user ID



A movie title



Display the predicted rating for that user–movie pair



Make sure:



pmf\_model.pth exists (either trained locally or provided),



data/ml-20m/movies.csv is present,



TMDB preprocessing (tmdb\_preprocess.py) and training (train.py) have been run at least once.



8\. Demo Notebook (demo.ipynb)

The notebook demo.ipynb is included as a simple, reproducible demonstration of:



Loading the trained model



Computing a prediction for a chosen user–movie pair



Comparing against a simple baseline (e.g., global mean rating)



To run the notebook:



bash

Copy code

jupyter notebook demo.ipynb

or open it directly via VS Code / JupyterLab.



9\. Notes and Assumptions

The project assumes the MovieLens 20M and TMDB data are correctly downloaded and placed in the data/ folder as described.



Raw datasets are not included in the repository.



Some large files (e.g., pmf\_model.pth, tmdb\_features.npy) may be stored using Git LFS and will be fetched automatically when cloning the repository, provided Git LFS is installed.



Hyperparameters (embedding dimension, learning rate, number of epochs, etc.) can be adjusted in train.py and model.py.



10\. Reproducibility Checklist

To fully reproduce the system from scratch:



Create the folder structure as shown under data/.



Download MovieLens 20M and place the CSV files under data/ml-20m/.



Download TMDB metadata and place the CSV files under data/tmdb/.



Install Python dependencies:



bash

Copy code

pip install -r requirements.txt

Run TMDB preprocessing:



bash

Copy code

python tmdb\_preprocess.py

Train the model:



bash

Copy code

python train.py

Run the Streamlit app:



bash

Copy code

streamlit run app.py

Optionally open demo.ipynb to inspect predictions and evaluation.

